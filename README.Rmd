---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE, results='hide'}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

![GitHub Logo](inst/logo/TestContR_150w.png)

# TestContR ![](https://travis-ci.org/Fredo-XVII/TestContR.svg?branch=master)

The primary goal of TestContR is to select randomized Test groups/individuals and matched them with Control groups/individuals using Euclidian distance. You also have the option to provide a list of test groups/individuals where by you can generate a list of control groups/individuals.

***
***

## Example - Randomised Sample match_*

R contains a crime data set for the all 50 states.  This data set contains data on murder rates, assaults, urban 
population and the occurances of rape.  The TestContR can be used to match states that have similar crime rates.

```{r, results='hide', message=FALSE}
library(dplyr)
library(TestContR)
```

### match_numeric(): Random Selection of Test and Control groups/individuals for numeric metrics/variables.
```{r df_1, warning=FALSE}
df <- datasets::USArrests %>% dplyr::mutate(state = base::row.names(USArrests)) %>%
                               dplyr::select(state, everything())
```

**Expected data set layout with labels/names/id in the first column:**
```{r}
knitr::kable(head(df, n = 10))
```

**Build Test and Control list**
```{r match_numeric}
set.seed(99)
TEST_CONTROL_LIST <- TestContR::match_numeric(df)
```

**Results of random selection option:**
```{r}
knitr::kable(TEST_CONTROL_LIST)
```
<br></br>

#### Providing a list of Test Groups/Individuals
```{r}
TEST_GRP <- tribble(~'TEST','Colorado','Minnesota','Florida','South Carolina')

```

**Example of data frame for the "test_list" input parameter:**
```{r}
knitr::kable(TEST_GRP)
```


```{r}
set.seed(99)
TEST_CONTROL_LIST <- TestContR::match_numeric(df, test_list = TEST_GRP)
```

**Results for the "test_list" input parameter:**
```{r}
knitr::kable(TEST_CONTROL_LIST)
```


### match_mixed(): Random Select of Test and Control groups/individuals with mixed metrics/variables.
```{r df_2, warning=FALSE}
df <- datasets::USArrests %>% dplyr::mutate(state = base::row.names(datasets::USArrests)) %>%
  base::cbind(datasets::state.division) %>%
  dplyr::select(state, dplyr::everything())
```

**Expected data set layout with labels/names/id in the first column:**
```{r}
knitr::kable(head(df, n = 10))
```

**Build Test and Control list from mixed metrics**
```{r match_mixed}
set.seed(99)
TEST_CONTROL_LIST <- TestContR::match_mixed(df)
```

**Results of random selection option:**
```{r}
knitr::kable(TEST_CONTROL_LIST)
```

---

#### Providing a list of Test Groups/Individuals
```{r}
TEST_GRP <- tribble(~'TEST','Colorado','Minnesota','Florida','South Carolina')

```

**Example of data frame for the "test_list" input parameter:**
```{r}
knitr::kable(TEST_GRP)
```


```{r}
set.seed(99)
TEST_CONTROL_LIST <- TestContR::match_mixed(df, test_list = TEST_GRP)
```

**Results for the "test_list" input parameter:**
```{r}
knitr::kable(TEST_CONTROL_LIST)
```

***
***

## Example - topn_* selection for individuals or groups

### topn_numeric(): Select Top N Controls for a group or individual
Topn_numeric() is used in the situation where you have 1 test group/individual and you are looking for Top N nearest matches using Euclidian distance. 
  - Note: You can provide more than one group, but the function does not remove duplicates in the control list for the more than 1 group or individual.
First, create a dataframe (1x1) as below with the label of the group/individual of interest.
```{r}
test_list <- tribble(~"TEST","Colorado")
```

Numeric only dataframe:
```{r df_3, warning=FALSE}
df <- datasets::USArrests %>% dplyr::mutate(state = base::row.names(USArrests)) %>%
                               dplyr::select(state, everything())
```

**Build the list of Top N matches **
Provide the test_list dataframe to the test_list parameter in the function as below.
```{r topn_numeric}
TOPN_CONTROL_LIST <- TestContR::topn_numeric(df, topN = 10, test_list = test_list)
```

**Results of Top N selection option:**
```{r}
knitr::kable(TOPN_CONTROL_LIST) %>% head(20)
```

**Top N without a Test List**
Don't be concerned about the warning; I just wanted to let users know that it would use all the labels in the dataframe.
```{r}
TOPN_CONTROL_LIST <- TestContR::topn_numeric(df, topN = 10)

```

**Results of Top N selection without Test List:**
```{r}
knitr::kable(TOPN_CONTROL_LIST) %>% head(20)
```

<br></br>


### topN_mixed(): Random Select of Test and Control groups/individuals with mixed metrics/variables.
```{r df_4, warning=FALSE}
df <- datasets::USArrests %>% dplyr::mutate(state = base::row.names(datasets::USArrests)) %>%
  base::cbind(datasets::state.division) %>%
  dplyr::select(state, dplyr::everything())
```

**Expected data set layout with labels/names/id in the first column:**
```{r}
knitr::kable(head(df, n = 10))
```

**Build Test and Control list from mixed metrics**
```{r}
set.seed(99)
TOPN_CONTROL_LIST <- TestContR::topn_mixed(df, topN = 10, test_list = test_list)
```

**Results of Top N selection without Test List:**
```{r}
knitr::kable(TOPN_CONTROL_LIST) %>% head(20)
```

**Top N Mixed without a Test List**
Don't be concerned about the warning; I just wanted to let users know that it would use all the labels in the dataframe.
```{r}
TOPN_CONTROL_LIST <- TestContR::topn_mixed(df, topN = 10)

```

**Results of Top N selection without Test List:**
```{r}
knitr::kable(TOPN_CONTROL_LIST) %>% head(20)
```

***
***

### Conclusion
Depending on your experiment, it may be prudent to add categorical metrics/variables that will help align your data better.  In the above examples, when only using the numerical data Alabama's nearest match is Louisiana, but once region is taken into consideration, Alabama's nearest match is Tennessee.  Now you have the tools to create a list of nearest matches for your data whether it is numeric or mixed.


***
***





